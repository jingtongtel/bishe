package com.boco.human.v01.controller;

import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.boco.human.v01.DataViewManager;
import com.boco.human.v01.RESTRequst;
import com.boco.human.v01.handler.ViewHandler;

@RestController
@CrossOrigin
@RequestMapping("/v00/metric")
public class RSController {
	//@RequestMapping(path="/travel/intensity",method = RequestMethod.POST)
	@PostMapping("/travel/intensity")
	public Object test(@RequestBody(required = false) Map<String, Map<String, ?>> map, HttpServletRequest request) {
		String metricName = request.getRequestURI().substring((request.getContextPath()+"/v01/metric").length(),
				request.getRequestURI().length());
		 System.out.println(metricName);
		RESTRequst dg = new RESTRequst(map, metricName);
		ViewHandler vh = DataViewManager.findViewHandler(dg.getHandlerId());
		return vh.getDataMap(dg.getRequestMap());

	}
	
	
	
	
	
	
/*	@RequestMapping("/travel/{id}")
	public Object test2(@RequestBody(required = false) Map<String, Map<String, ?>> map, HttpServletRequest request) {
		
		 * System.out.println(request.getRequestURI().substring(request.
		 * getContextPath().length(),request.getRequestURI().length()));
		 * System.out.println(request.getRequestURL());
		 * System.out.println(request.getContextPath());
		 
		String metricName = request.getRequestURI().substring(request.getContextPath().length(),
				request.getRequestURI().length());
		 System.out.println(metricName);
		RESTRequst dg = new RESTRequst(map, metricName);
		ViewHandler vh = DataViewManager.findViewHandler(dg.getHandlerId());
		Map resultMap = vh.getDataMap(dg.getRequestMap());
		resultMap.put("server timestamp", System.currentTimeMillis());
		return resultMap;

	}

	@RequestMapping("/metric/pop{id}/{name}")
	public Object url(@RequestBody(required = false) Map<String, Map<String, ?>> map, @PathVariable String id, @PathVariable String name,
			HttpServletRequest request) {
		System.err.println(id);System.err.println(name);
		Map resultMap = new HashMap();
		resultMap.put("server timestamp", System.currentTimeMillis());
		return resultMap;
	}*/

}
