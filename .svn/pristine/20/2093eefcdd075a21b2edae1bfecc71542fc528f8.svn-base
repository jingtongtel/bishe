package com.boco.human.v01.handler;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Properties;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import com.boco.human.util.Asserts;
import com.boco.human.v01.service.CodeService;

/**
 * 数据字典的默认数据格式实现
 * 
 *
 */
@Component
public class DictionaryBusiDefHandler extends AbstractViewHandler {

	@Autowired
	private CodeService service;
	
	
	/**
	 * 从配置文件中注入指标名称
	 */
	@Value("#{rsconfig['code.dictionary.busi']}")
	private String metricName;
	
	@Autowired
	Properties rsconfig;

	@Override
	protected String getMetricName() {
		// TODO Auto-generated method stub
		return this.metricName;
	}

	@Override
	protected String getDataViewName() {
		// TODO Auto-generated method stub
		return DATAVIEW_DEF_NAME;
	}
	
	
	

	@Override
	protected Object formatData(Map paraMap) {
		// TODO Auto-generated method stub		
		//Asserts.notNull(paraMap.get("busiTypes"), "参数对象 busiTypes 不能为空");
		Asserts.notEmpty((List)paraMap.get("busiTypes"), "参数对象 busiTypes 不能为空");
		System.out.println(paraMap);
		String key = "";
		List<Map> list = service.queryDictionayByBusi(paraMap);
		List<Map<String,?>> itemList = null;
		Map resultMap = new HashMap();
		for(Map map:list){
			if(!key.equals((String)map.get("groupName"))){
				key = (String)map.get("groupName");
				itemList = new ArrayList<Map<String,?>>();
				resultMap.put(key, itemList);
			}
			Map itemMap = new HashMap();
			itemList.add(itemMap);
			itemMap.put("value",map.get("dicValue"));
			itemMap.put("name",map.get("dicName"));
			itemMap.put("type",map.get("dicType"));
			//itemMap.put("busiName",map.get("GROUP_NAME"));
		}
		
		return resultMap;
	}
}
