<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boco.human.v01.mapper.CorridorMapper">


<!-- 通过粒度字段判断查询哪个表 -->
	<!-- 通过粒度字段判断查询哪个表 -->
	<sql id="queryTable">
		<choose>
			<when test='timeSize.equals("1")'>
				DM_CORRIDOR_H
			</when>
			<when test='timeSize.equals("2")'>
				DM_CORRIDOR_D
			</when>
			<when test='timeSize.equals("3")'>
				DM_CORRIDOR_W
			</when>
			<when test='timeSize.equals("4")'>
				DM_CORRIDOR_M
			</when>
			<when test='timeSize.equals("5")'>
				DM_CORRIDOR_Q
			</when>
			
			<otherwise>  <!-- 异常处理 -->
				DM_CORRIDOR_D
			</otherwise>
		</choose>
	</sql>
	
	<select id="corridorQuery"    parameterType="Map"  resultType="hashMap">
		select CORRIDOR_NAME corridor_name,
		 ROAD_NAME road_name, 
		 USER_SUM  user_sum, 
		 IMPORTANCE importance,
		 TIDE_ATTRIBUTE tide_attribute
  from <include refid="queryTable"></include>   q
  <where>
  	<if test="userType!=null and !userType.equals('')">
		AND q.USER_TYPE_ID = #{userType}
	</if>
 	<if test="corridor!=null and !corridor.equals('')">
		AND	q.CORRIDOR_ID in
		<foreach item="item" index="index" collection="corridor" open="(" separator="," close=")">
			#{item}
		</foreach>
	</if>
	<if test="road!=null and !road.equals('')">
		AND	q.ROAD_ID in
		<foreach item="item" index="index" collection="road" open="(" separator="," close=")">
			#{item}
		</foreach>
	</if>
	<if test="odPurpose!=null and !odPurpose.equals('')">
		AND	q.OD_PURPOSE_ID in
		<foreach item="item" index="index" collection="odPurpose" open="(" separator="," close=")">
			#{item}
		</foreach>
	</if>
	<if test="odWay!=null and !odWay.equals('')">
		AND	q.OD_WAY_ID in
		<foreach item="item" index="index" collection="odWay" open="(" separator="," close=")">
			#{item}
		</foreach>
	</if>
	<if test="corridorDate!=null and !corridorDate.equals('')">
		AND	q.CORRIDOR_DATE in
		<foreach item="item" index="index" collection="corridorDate" open="(" separator="," close=")">
			#{item}
		</foreach>
	</if>
	
      
  
  </where>


		
		
			
	</select>

</mapper>